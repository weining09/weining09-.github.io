<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>éšæœºç‚¹åç³»ç»Ÿ V3.0</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <style>
        /* è‡ªå®šä¹‰é¢œè‰²å˜é‡ */
        :root {
            --neon-blue: #4dabff;     /* éœ“è™¹è“è‰² */
            --neon-purple: #bc13fe;   /* éœ“è™¹ç´«è‰² */
            --matrix-green: #00ff41;  /* çŸ©é˜µç»¿è‰² */
        }

        /* åŸºç¡€é¡µé¢æ ·å¼ */
        body {
            background: #0a0a28;      /* æ·±è“è‰²èƒŒæ™¯ */
            font-family: 'Microsoft Yahei', sans-serif; /* ä¸­æ–‡å­—ä½“è®¾ç½® */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;         /* éšè—æ»šåŠ¨æ¡ */
        }

        /* ä¸»å®¹å™¨æ ·å¼ */
        .cyber-container {
            position: relative;
            margin-top: 3vh;  /* è§†å£é«˜åº¦ç™¾åˆ†æ¯”å¸ƒå±€ */
            width: 90vw; /* å“åº”å¼å®½åº¦ */
            max-width: 1000px; /* æœ€å¤§å®½åº¦é™åˆ¶ */
            transform: scale(1.1);
            transform-origin: top center;
        }

        /* éœ“è™¹è¾¹æ¡†æ•ˆæœå®¹å™¨ */
        .neon-frame {
            background: rgba(16, 16, 48, 0.95); /* åŠé€æ˜èƒŒæ™¯ */
            border: 3px solid var(--neon-blue);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 0 30px var(--neon-purple), /* å¤–å‘å…‰ */
                        inset 0 0 15px var(--neon-blue); /* å†…å‘å…‰ */
            backdrop-filter: blur(5px); /* èƒŒæ™¯æ¨¡ç³Šæ•ˆæœ */
            position: relative;
            min-height: 300px;        /* æœ€å°é«˜åº¦ä¿è¯å¸ƒå±€ */
        }

        /* æ ‡é¢˜æ ·å¼ */
        .cyber-title {
            text-align: center;
            position: relative;
            margin-bottom: 3rem;
            perspective: 1000px;      /* 3Dé€è§†æ•ˆæœ */
        }

        /* æ ‡é¢˜æ–‡å­—æ•ˆæœ */
        .title-text {
            font-size: 3.5rem;
            color: var(--neon-purple);
            text-shadow: 0 0 15px var(--neon-purple); /* æ–‡å­—å‘å…‰ */
            position: relative;
            z-index: 2;
            transform-style: preserve-3d; /* ä¿æŒ3Då˜æ¢ */
			animation: 
				titleScan 2s linear infinite,
                titleBlink 1s step-end infinite;
        }

        @keyframes titleScan {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes titleBlink {
            50% { opacity: 0.3; }
        }

        /* ç‰ˆæœ¬å·æ ·å¼ */
        .title-version {
            font-size: 1.6rem;
            color: var(--neon-blue);
            display: block;
            margin-top: 0.8rem;
            position: relative;
        }

        /* ç»“æœæ˜¾ç¤ºåŒºåŸŸ */
        #display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* å±…ä¸­å®šä½ */
            width: 100%;
            padding: 0 20px;
            text-align: center;
            font-size: 5rem;
            color: var(--matrix-green);
            text-shadow: 0 0 20px var(--matrix-green); /* ç»¿è‰²å‘å…‰æ•ˆæœ */
            min-height: 150px;
            letter-spacing: 0.2em;    /* å­—æ¯é—´è· */
            transition: all 0.05s;    /* å¹³æ»‘è¿‡æ¸¡ */
            font-family: 'Courier New', monospace; /* ç­‰å®½å­—ä½“ */
        }

        /* èµ›åšé£æ ¼æŒ‰é’® */
        .cyber-button {
            background: linear-gradient(45deg, #0011ff, #ff00c8); /* æ¸å˜èƒŒæ™¯ */
            border: 2px solid var(--neon-blue);
            color: white;
            padding: 1rem 2rem;
            font-size: 1.2rem;
            cursor: pointer;
            position: relative;
            overflow: hidden;         /* éšè—æ‰«æçº¿æº¢å‡º */
            border-radius: 8px;
            margin: 1rem;
            transition: 0.3s;         /* æ‚¬åœè¿‡æ¸¡æ•ˆæœ */
        }

        /* æŒ‰é’®æ‰«æçº¿æ•ˆæœ */
        .cyber-button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                transparent 25%,
                rgba(255,255,255,0.2) 50%,
                transparent 75%);
            transform: rotate(45deg);
            animation: scan 3s linear infinite; /* æ‰«æåŠ¨ç”» */
        }

        /* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸæ ·å¼ */
        .file-upload {
            position: absolute;
			right: 20px;        /* è·ç¦»å³ä¾§20px */
			bottom: 20px;          /* è·ç¦»é¡¶éƒ¨20px */
            display: inline-block;
            padding: 12px 30px;
            background: rgba(16, 16, 48, 0.8);
            border: 2px dashed var(--neon-purple); /* è™šçº¿è¾¹æ¡† */
            color: var(--neon-blue);
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
        }

        /* ç²’å­ç”»å¸ƒæ ·å¼ */
        #particles {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;     /* ä¸é˜»æŒ¡é¼ æ ‡äº‹ä»¶ */
            z-index: -1;             /* ç½®äºåº•å±‚ */
        }

        /* çŠ¶æ€ä¿¡æ¯æ ·å¼ */
        .status-info {
            color: var(--neon-blue);
            font-size: 0.9rem;
            margin-top: 1rem;
        }

        /* æ‰«æçº¿åŠ¨ç”» */
        @keyframes scan {
            0% { transform: translateX(-150%) rotate(45deg); }
            100% { transform: translateX(150%) rotate(45deg); }
        }

        /* ç»“æœå‘å…‰åŠ¨ç”» */
        @keyframes resultGlow {
            0% { text-shadow: 0 0 10px var(--matrix-green); }
            50% { text-shadow: 0 0 40px var(--matrix-green); }
            100% { text-shadow: 0 0 20px var(--matrix-green); }
        }
		
		/* ç‰ˆæƒä¿¡æ¯æ ·å¼ */
		.cyber-copyright {
			position: fixed;
			bottom: 20px;
			left: 50%;
			transform: translateX(-50%);
			color: rgba(77, 171, 255, 0.8);
			font-size: 0.9rem;
			text-shadow: 0 0 10px rgba(77, 171, 255, 0.5);
			text-align: center;
			padding: 8px 20px;
			background: rgba(16, 16, 48, 0.9);
			border: 1px solid rgba(77, 171, 255, 0.3);
			border-radius: 15px;
			backdrop-filter: blur(3px);
			animation: copyrightPulse 2s ease-in-out infinite;
		}

		.crypto-signal {
			display: inline-block;
			width: 8px;
			height: 8px;
			background: #00ff41;
			border-radius: 50%;
			box-shadow: 0 0 8px #00ff41;
			margin-left: 5px;
			animation: cryptoBlink 1.5s steps(2) infinite;
		}

		@keyframes copyrightPulse {
			0% { opacity: 0.8; transform: translateX(-50%) scale(0.98); }
			50% { opacity: 1; transform: translateX(-50%) scale(1.02); }
			100% { opacity: 0.8; transform: translateX(-50%) scale(0.98); }
		}

		@keyframes cryptoBlink {
			0% { opacity: 0.3; }
			100% { opacity: 1; }
		}
    </style>
</head>
<body>
    <canvas id="particles"></canvas>
    
    <div class="cyber-container">
        <div class="neon-frame">
            <label class="file-upload">
                <input type="file" id="fileInput" accept=".xlsx,.xls" hidden>
                âš¡ ä¸Šä¼ å­¦ç”Ÿåå• âš¡
            </label>
            
            <div class="cyber-title">
                <div class="title-text">
                    â–ˆâ–“â–’â–‘ AIåŠ©æ•™ç‚¹åç³»ç»Ÿ â–‘â–’â–“â–ˆ
                </div>
            </div>
            <div id="display">â–¶ å‡†å¤‡å°±ç»ª</div>

            <div style="text-align:center; margin-top: 180px;">
                <button class="cyber-button" id="startBtn">å¯åŠ¨æ‰«æ</button>
                <button class="cyber-button" id="resetBtn">ç³»ç»Ÿé‡ç½®</button>
            </div>

            <div class="status-info" id="status"></div>
        </div>
    </div>

    <script>
        const App = (() => {
            // ç§æœ‰çŠ¶æ€
            let students = [];
            let isRunning = false;
            let animationFrame = null;

            // DOM å…ƒç´ ç¼“å­˜
            const elements = {
                display: document.getElementById('display'),
                startBtn: document.getElementById('startBtn'),
                status: document.getElementById('status'),
                fileInput: document.getElementById('fileInput'),
                resetBtn: document.getElementById('resetBtn')
            };

            // ç²’å­ç³»ç»Ÿæ¨¡å—
            const ParticleSystem = (() => {
                class CyberParticle {
                    constructor(canvas) {
                        this.canvas = canvas;
                        this.reset(true);
                        this.angle = Math.random() * Math.PI * 2;
                        this.speed = 0.8 + Math.random() * 1.2;
                        this.radius = Math.random() * 3 + 1;
                    }

                    reset(init) {
                        const { width, height } = this.canvas;
                        if(init) {
                            this.x = Math.random() * width;
                            this.y = Math.random() * height;
                        } else {
                            this.x = Math.random() * width * 1.5 - width * 0.25;
                            this.y = Math.random() * height * 1.5 - height * 0.25;
                        }
                        this.baseX = this.x;
                        this.baseY = this.y;
                        this.hue = Math.random() * 60 + 200;
                        this.lightness = 50 + Math.random() * 10;
                        this.alpha = 0.4 + Math.random() * 0.3;
                    }

                    update() {
                        this.angle += this.speed * 0.02;
                        this.x = this.baseX + Math.cos(this.angle) * 35;
                        this.y = this.baseY + Math.sin(this.angle * 0.8) * 35;

                        if(this.x < -150 || this.x > this.canvas.width + 150 || 
                           this.y < -150 || this.y > this.canvas.height + 150) {
                            this.reset();
                        }
                    }

                    draw(ctx) {
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                        const gradient = ctx.createRadialGradient(
                            this.x, this.y, 0, 
                            this.x, this.y, this.radius * 3
                        );
                        gradient.addColorStop(0, `hsla(${this.hue}, 80%, ${this.lightness}%, ${this.alpha})`);
                        gradient.addColorStop(1, `hsla(${this.hue}, 90%, ${this.lightness - 20}%, 0)`);
                        ctx.fillStyle = gradient;
                        ctx.fill();
                    }
                }

                return {
                    init: function() {
                        const canvas = document.getElementById('particles');
                        const ctx = canvas.getContext('2d');
                        canvas.width = window.innerWidth;
                        canvas.height = window.innerHeight;

                        const particles = Array.from({ length: 120 }, () => new CyberParticle(canvas));

                        const animate = () => {
                            ctx.fillStyle = 'rgb(10, 10, 40)';
                            ctx.fillRect(0, 0, canvas.width, canvas.height);

                            particles.forEach(p => {
                                p.update();
                                p.draw(ctx);
                            });

                            particles.forEach(p1 => {
                                particles.forEach(p2 => {
                                    const dx = p1.x - p2.x;
                                    const dy = p1.y - p2.y;
                                    const dist = Math.sqrt(dx * dx + dy * dy);
                                    if(dist < 150) {
                                        ctx.beginPath();
                                        ctx.moveTo(p1.x, p1.y);
                                        ctx.lineTo(p2.x, p2.y);
                                        ctx.strokeStyle = `hsla(${(p1.hue + p2.hue)/2}, 70%, 60%, ${1 - dist/150})`;
                                        ctx.lineWidth = 0.8;
                                        ctx.stroke();
                                    }
                                });
                            });

                            requestAnimationFrame(animate);
                        };
                        animate();
                    }
                };
            })();

            // ä¸šåŠ¡é€»è¾‘æ¨¡å—
            const BusinessLogic = {
                handleFile: async function(e) {
                    try {
                        const file = e.target.files[0];
                        if (!file) return;

                        const data = await file.arrayBuffer();
                        const workbook = XLSX.read(data);
                        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                        const { data: parsedData, header } = this.parseSheet(worksheet);

                        students = parsedData;
                        this.updateStatus(`å·²åŠ è½½ ${students.length} åå­¦ç”Ÿ | æ£€æµ‹åˆ—ï¼š"${header}"`);
                        elements.display.textContent = "âœ… å‡†å¤‡å®Œæˆ";
                    } catch (error) {
                        alert(`é”™è¯¯ï¼š${error.message}`);
                        this.reset();
                    }
                },

                parseSheet: function(worksheet) {
					const sheetData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
					let targetRowIndex = -1;
					let targetCol = -1;

					// å…ˆæ£€æŸ¥ç¬¬ä¸€è¡Œï¼Œå†æ£€æŸ¥ç¬¬äºŒè¡Œ
					for (let rowIndex = 0; rowIndex <= 1; rowIndex++) {
						if (!sheetData[rowIndex]) continue;
						
						targetCol = sheetData[rowIndex].findIndex(h => 
							/^(åå­—|å§“å|å­¦ç”Ÿå§“å)/i.test(String(h).trim())
						);
						
						if (targetCol !== -1) {
							targetRowIndex = rowIndex;
							break;
						}
					}

					if (targetCol === -1) throw new Error('æœªæ‰¾åˆ°å§“ååˆ—');
					
					// ç¡®å®šæ•°æ®èµ·å§‹è¡Œï¼ˆè·³è¿‡æ ‡é¢˜è¡Œï¼‰
					const dataStart = targetRowIndex + 1;
					const headers = sheetData[targetRowIndex];

					return {
						data: sheetData.slice(dataStart)
							.map(row => row?.[targetCol])
							.filter(name => name?.toString().trim()),
						header: headers[targetCol]
					};
				},

                toggleRoll: function() {
                    if (!students.length) return alert('è¯·å…ˆä¸Šä¼ å­¦ç”Ÿåå•ï¼');
                    
                    isRunning = !isRunning;
                    elements.startBtn.textContent = isRunning ? 'ç»ˆæ­¢æ‰«æ' : 'å¯åŠ¨æ‰«æ';

                    isRunning ? this.startAnimation() : this.showResult();
                },

                startAnimation: function() {
					// é€Ÿåº¦æ§åˆ¶å‚æ•°é…ç½®ï¼ˆæ ¸å¿ƒè°ƒèŠ‚ç‚¹ï¼‰
					const SPEED = {
						NAME_UPDATE: 45,      // åå­—æ›´æ–°é—´éš”(ms)ï¼Œå€¼è¶Šå¤§é€Ÿåº¦è¶Šæ…¢
						SCALE_FREQ: 0.1,     // ç¼©æ”¾æ³¢åŠ¨é¢‘ç‡ï¼Œå€¼è¶Šå°å˜åŒ–è¶Šæ…¢
						ROTATE_FREQ: 0.2,    // æ—‹è½¬æ³¢åŠ¨é¢‘ç‡ï¼Œå€¼è¶Šå°å˜åŒ–è¶Šæ…¢
						HUE_SPEED: 2,        // é¢œè‰²å˜åŒ–é€Ÿåº¦ï¼Œå€¼è¶Šå°å˜åŒ–è¶Šæ…¢
						COUNT_STEP: 0.4       // è®¡æ•°å™¨æ­¥é•¿ï¼Œå€¼è¶Šå°æ•´ä½“åŠ¨ç”»è¶Šæ…¢
					};

					let count = 0;
					let lastUpdate = 0;
					
					const animate = (timestamp) => {
						if (!isRunning) return;

						// åå­—åˆ·æ–°é€Ÿåº¦æ§åˆ¶ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
						if (timestamp - lastUpdate > SPEED.NAME_UPDATE) {
							elements.display.textContent = 
								students[Math.random() * students.length | 0];
							lastUpdate = timestamp;
						}

						// åŠ¨æ€æ•ˆæœé€Ÿåº¦æ§åˆ¶ï¼ˆæ ¸å¿ƒå…¬å¼ï¼‰
						elements.display.style.transform = `
							translate(-50%, -50%)
							scale(${1 + Math.sin(count * SPEED.SCALE_FREQ) * 0.2})
							rotate(${Math.sin(count * SPEED.ROTATE_FREQ) * 3}deg)
						`;
						elements.display.style.color = 
							`hsl(${(count * SPEED.HUE_SPEED) % 360}, 100%, 60%)`;

						count += SPEED.COUNT_STEP;  // å…¨å±€åŠ¨ç”»è¿›åº¦æ§åˆ¶
						animationFrame = requestAnimationFrame(animate);
					};
					animate(performance.now());
                },

                showResult: function() {
                    cancelAnimationFrame(animationFrame);
                    elements.display.style.animation = 'none';
                    void elements.display.offsetWidth;
                    elements.display.style.animation = 'resultGlow 1s ease-out';
                    elements.display.textContent = 
                        `ğŸ¯ ${students[Math.random() * students.length | 0]}`;
                },

                updateStatus: function(text) {
                    elements.status.innerHTML = 
                        `<span style="color: var(--neon-purple)">âš¡</span> ${text}`;
                },

                reset: function() {
                    students = [];
                    isRunning = false;
                    cancelAnimationFrame(animationFrame);
                    elements.display.textContent = "â–¶ å‡†å¤‡å°±ç»ª";
                    elements.startBtn.textContent = 'å¯åŠ¨æ‰«æ';
                    elements.fileInput.value = '';
                    this.updateStatus('ç­‰å¾…æ•°æ®è¾“å…¥...');
                }
            };

            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
            const initEventListeners = () => {
                elements.fileInput.addEventListener('change', 
                    e => BusinessLogic.handleFile(e));
                elements.startBtn.addEventListener('click', 
                    () => BusinessLogic.toggleRoll());
                elements.resetBtn.addEventListener('click', 
                    () => BusinessLogic.reset());
            };

            return {
                init: function() {
                    ParticleSystem.init();
                    initEventListeners();
                    BusinessLogic.updateStatus('ç³»ç»Ÿå°±ç»ª');
                    window.addEventListener('resize', () => {
                        const canvas = document.getElementById('particles');
                        canvas.width = window.innerWidth;
                        canvas.height = window.innerHeight;
                    });
                }
            };
        })();

        // åˆå§‹åŒ–åº”ç”¨
        window.onload = () => App.init();
    </script>
	<div class="cyber-copyright">
		Â© 2025 weining ç‰ˆæƒæ‰€æœ‰ | ç‰ˆæœ¬ V1.0 <span class="crypto-signal"></span>
	</div>
</body>
</html>