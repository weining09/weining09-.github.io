<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- 保持原有样式不变 -->
    <meta charset="UTF-8">
    <title>AI智能点名系统 V3.0</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <style>
        /* 自定义颜色变量 */
        :root {
            --neon-blue: #4dabff;     /* 霓虹蓝色 */
            --neon-purple: #bc13fe;   /* 霓虹紫色 */
            --matrix-green: #00ff41;  /* 矩阵绿色 */
        }

        /* 基础页面样式 */
        body {
            background: #0a0a28;      /* 深蓝色背景 */
            font-family: 'Microsoft Yahei', sans-serif; /* 中文字体设置 */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;         /* 隐藏滚动条 */
        }

        /* 主容器样式 */
        .cyber-container {
            position: relative;
            margin-top: 5vh;          /* 视口高度百分比布局 */
            width: 80vw;             /* 响应式宽度 */
            max-width: 800px;        /* 最大宽度限制 */
        }

        /* 霓虹边框效果容器 */
        .neon-frame {
            background: rgba(16, 16, 48, 0.95); /* 半透明背景 */
            border: 3px solid var(--neon-blue);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 0 30px var(--neon-purple), /* 外发光 */
                        inset 0 0 15px var(--neon-blue); /* 内发光 */
            backdrop-filter: blur(5px); /* 背景模糊效果 */
            position: relative;
            min-height: 300px;        /* 最小高度保证布局 */
        }

        /* 标题样式 */
        .cyber-title {
            text-align: center;
            position: relative;
            margin-bottom: 3rem;
            perspective: 1000px;      /* 3D透视效果 */
        }

        /* 标题文字效果 */
        .title-text {
            font-size: 2.8rem;
            color: var(--neon-purple);
            text-shadow: 0 0 15px var(--neon-purple); /* 文字发光 */
            position: relative;
            z-index: 2;
            transform-style: preserve-3d; /* 保持3D变换 */
			animation: 
				titleScan 2s linear infinite,
                titleBlink 1s step-end infinite;
        }

        @keyframes titleScan {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes titleBlink {
            50% { opacity: 0.3; }
        }

        /* 版本号样式 */
        .title-version {
            font-size: 1.4rem;
            color: var(--neon-blue);
            display: block;
            margin-top: 0.8rem;
            position: relative;
        }

        /* 结果显示区域 */
        #display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* 居中定位 */
            width: 100%;
            padding: 0 20px;
            text-align: center;
            font-size: 4rem;
            color: var(--matrix-green);
            text-shadow: 0 0 20px var(--matrix-green); /* 绿色发光效果 */
            min-height: 120px;
            letter-spacing: 0.2em;    /* 字母间距 */
            transition: all 0.05s;    /* 平滑过渡 */
            font-family: 'Courier New', monospace; /* 等宽字体 */
        }

        /* 赛博风格按钮 */
        .cyber-button {
            background: linear-gradient(45deg, #0011ff, #ff00c8); /* 渐变背景 */
            border: 2px solid var(--neon-blue);
            color: white;
            padding: 1rem 2rem;
            font-size: 1.2rem;
            cursor: pointer;
            position: relative;
            overflow: hidden;         /* 隐藏扫描线溢出 */
            border-radius: 8px;
            margin: 1rem;
            transition: 0.3s;         /* 悬停过渡效果 */
        }

        /* 按钮扫描线效果 */
        .cyber-button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                transparent 25%,
                rgba(255,255,255,0.2) 50%,
                transparent 75%);
            transform: rotate(45deg);
            animation: scan 3s linear infinite; /* 扫描动画 */
        }

        /* 文件上传区域样式 */
        .file-upload {
            position: absolute;
			right: 20px;        /* 距离右侧20px */
			bottom: 20px;          /* 距离顶部20px */
            display: inline-block;
            padding: 12px 30px;
            background: rgba(16, 16, 48, 0.8);
            border: 2px dashed var(--neon-purple); /* 虚线边框 */
            color: var(--neon-blue);
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
        }

        /* 粒子画布样式 */
        #particles {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;     /* 不阻挡鼠标事件 */
            z-index: -1;             /* 置于底层 */
        }

        /* 状态信息样式 */
        .status-info {
            color: var(--neon-blue);
            font-size: 0.9rem;
            margin-top: 1rem;
        }

        /* 扫描线动画 */
        @keyframes scan {
            0% { transform: translateX(-150%) rotate(45deg); }
            100% { transform: translateX(150%) rotate(45deg); }
        }

        /* 结果发光动画 */
        @keyframes resultGlow {
            0% { text-shadow: 0 0 10px var(--matrix-green); }
            50% { text-shadow: 0 0 40px var(--matrix-green); }
            100% { text-shadow: 0 0 20px var(--matrix-green); }
        }
    </style>
</head>
<body>
    <canvas id="particles"></canvas>
    
    <div class="cyber-container">
        <div class="neon-frame">
            <label class="file-upload">
                <input type="file" id="fileInput" accept=".xlsx,.xls" hidden>
                ⚡ 上传学生名单 ⚡
            </label>
            
            <div class="cyber-title">
                <div class="title-text">
                    █▓▒░ AI智能点名系统 ░▒▓█
                </div>
            </div>
            <div id="display">▶ 准备就绪</div>

            <div style="text-align:center; margin-top: 180px;">
                <button class="cyber-button" id="startBtn">启动扫描</button>
                <button class="cyber-button" id="resetBtn">系统重置</button>
            </div>

            <div class="status-info" id="status"></div>
        </div>
    </div>

    <script>
        const App = (() => {
            // 私有状态
            let students = [];
            let isRunning = false;
            let animationFrame = null;

            // DOM 元素缓存
            const elements = {
                display: document.getElementById('display'),
                startBtn: document.getElementById('startBtn'),
                status: document.getElementById('status'),
                fileInput: document.getElementById('fileInput'),
                resetBtn: document.getElementById('resetBtn')
            };

            // 粒子系统模块
            const ParticleSystem = (() => {
                class CyberParticle {
                    constructor(canvas) {
                        this.canvas = canvas;
                        this.reset(true);
                        this.angle = Math.random() * Math.PI * 2;
                        this.speed = 0.8 + Math.random() * 1.2;
                        this.radius = Math.random() * 3 + 1;
                    }

                    reset(init) {
                        const { width, height } = this.canvas;
                        if(init) {
                            this.x = Math.random() * width;
                            this.y = Math.random() * height;
                        } else {
                            this.x = Math.random() * width * 1.5 - width * 0.25;
                            this.y = Math.random() * height * 1.5 - height * 0.25;
                        }
                        this.baseX = this.x;
                        this.baseY = this.y;
                        this.hue = Math.random() * 60 + 200;
                        this.lightness = 50 + Math.random() * 10;
                        this.alpha = 0.4 + Math.random() * 0.3;
                    }

                    update() {
                        this.angle += this.speed * 0.02;
                        this.x = this.baseX + Math.cos(this.angle) * 35;
                        this.y = this.baseY + Math.sin(this.angle * 0.8) * 35;

                        if(this.x < -150 || this.x > this.canvas.width + 150 || 
                           this.y < -150 || this.y > this.canvas.height + 150) {
                            this.reset();
                        }
                    }

                    draw(ctx) {
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                        const gradient = ctx.createRadialGradient(
                            this.x, this.y, 0, 
                            this.x, this.y, this.radius * 3
                        );
                        gradient.addColorStop(0, `hsla(${this.hue}, 80%, ${this.lightness}%, ${this.alpha})`);
                        gradient.addColorStop(1, `hsla(${this.hue}, 90%, ${this.lightness - 20}%, 0)`);
                        ctx.fillStyle = gradient;
                        ctx.fill();
                    }
                }

                return {
                    init: function() {
                        const canvas = document.getElementById('particles');
                        const ctx = canvas.getContext('2d');
                        canvas.width = window.innerWidth;
                        canvas.height = window.innerHeight;

                        const particles = Array.from({ length: 120 }, () => new CyberParticle(canvas));

                        const animate = () => {
                            ctx.fillStyle = 'rgb(10, 10, 40)';
                            ctx.fillRect(0, 0, canvas.width, canvas.height);

                            particles.forEach(p => {
                                p.update();
                                p.draw(ctx);
                            });

                            particles.forEach(p1 => {
                                particles.forEach(p2 => {
                                    const dx = p1.x - p2.x;
                                    const dy = p1.y - p2.y;
                                    const dist = Math.sqrt(dx * dx + dy * dy);
                                    if(dist < 150) {
                                        ctx.beginPath();
                                        ctx.moveTo(p1.x, p1.y);
                                        ctx.lineTo(p2.x, p2.y);
                                        ctx.strokeStyle = `hsla(${(p1.hue + p2.hue)/2}, 70%, 60%, ${1 - dist/150})`;
                                        ctx.lineWidth = 0.8;
                                        ctx.stroke();
                                    }
                                });
                            });

                            requestAnimationFrame(animate);
                        };
                        animate();
                    }
                };
            })();

            // 业务逻辑模块
            const BusinessLogic = {
                handleFile: async function(e) {
                    try {
                        const file = e.target.files[0];
                        if (!file) return;

                        const data = await file.arrayBuffer();
                        const workbook = XLSX.read(data);
                        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                        const { data: parsedData, header } = this.parseSheet(worksheet);

                        students = parsedData;
                        this.updateStatus(`已加载 ${students.length} 名学生 | 检测列："${header}"`);
                        elements.display.textContent = "✅ 准备完成";
                    } catch (error) {
                        alert(`错误：${error.message}`);
                        this.reset();
                    }
                },

                parseSheet: function(worksheet) {
                    const sheetData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    const headers = sheetData[0] || [];
                    const targetCol = headers.findIndex(h => /^(名字|姓名)/i.test(h));
                    
                    if (targetCol === -1) throw new Error('未找到姓名列');
                    
                    return {
                        data: sheetData.slice(1)
                            .map(row => row[targetCol])
                            .filter(name => name?.trim?.()),
                        header: headers[targetCol]
                    };
                },

                toggleRoll: function() {
                    if (!students.length) return alert('请先上传学生名单！');
                    
                    isRunning = !isRunning;
                    elements.startBtn.textContent = isRunning ? '终止扫描' : '启动扫描';

                    isRunning ? this.startAnimation() : this.showResult();
                },

                startAnimation: function() {
                    let count = 0;
                    const animate = () => {
                        if (!isRunning) return;
                        
                        elements.display.textContent = 
                            students[Math.random() * students.length | 0];
                        elements.display.style.transform = `
                            translate(-50%, -50%)
                            scale(${1 + Math.sin(count * 0.1) * 0.2})
                            rotate(${Math.sin(count * 0.05) * 3}deg)
                        `;
                        elements.display.style.color = 
                            `hsl(${(count * 5) % 360}, 100%, 60%)`;
                        
                        count++;
                        animationFrame = requestAnimationFrame(animate);
                    };
                    animate();
                },

                showResult: function() {
                    cancelAnimationFrame(animationFrame);
                    elements.display.style.animation = 'none';
                    void elements.display.offsetWidth;
                    elements.display.style.animation = 'resultGlow 1s ease-out';
                    elements.display.textContent = 
                        `🎯 ${students[Math.random() * students.length | 0]}`;
                },

                updateStatus: function(text) {
                    elements.status.innerHTML = 
                        `<span style="color: var(--neon-purple)">⚡</span> ${text}`;
                },

                reset: function() {
                    students = [];
                    isRunning = false;
                    cancelAnimationFrame(animationFrame);
                    elements.display.textContent = "▶ 准备就绪";
                    elements.startBtn.textContent = '启动扫描';
                    elements.fileInput.value = '';
                    this.updateStatus('等待数据输入...');
                }
            };

            // 初始化事件监听
            const initEventListeners = () => {
                elements.fileInput.addEventListener('change', 
                    e => BusinessLogic.handleFile(e));
                elements.startBtn.addEventListener('click', 
                    () => BusinessLogic.toggleRoll());
                elements.resetBtn.addEventListener('click', 
                    () => BusinessLogic.reset());
            };

            return {
                init: function() {
                    ParticleSystem.init();
                    initEventListeners();
                    BusinessLogic.updateStatus('系统就绪');
                    window.addEventListener('resize', () => {
                        const canvas = document.getElementById('particles');
                        canvas.width = window.innerWidth;
                        canvas.height = window.innerHeight;
                    });
                }
            };
        })();

        // 初始化应用
        window.onload = () => App.init();
    </script>
</body>
</html>